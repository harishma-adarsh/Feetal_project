<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FetoScope Patient Portal - Medical Reports & Appointments</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
.modal {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,.55);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.score-circle {
  width: 130px; height: 130px; border-radius: 50%;
  background: #0ea5e9;
  color: white; font-size: 38px; font-weight: 700;
  display: flex; justify-content: center; align-items: center;
  margin: 20px auto;
}
.close-btn {
  background: none; border: none;
  position: absolute; top: 12px; right: 18px;
  font-size: 20px; cursor: pointer; color: #555;
}
.result-section ul {
  list-style: none; padding: 0;
}
.result-section ul li {
  margin: 6px 0; font-size: 15px; color:#374151;
  display: flex; gap: 6px; align-items: center;
}
.result-section ul li i { color: #10b981; }
.modal-content h2 { text-align:center; margin-bottom:10px; }
.result-header { margin-bottom:15px; }
@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}
</style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" style="background: white;">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-baby" style="color: #2563eb;" ></i>
                <span style="color: #2563eb;">FetoScope</span>
            </div>
            <ul class="nav-menu" >
                <li><a href="{% url 'feetal_app:index' %}" style="color: #2563eb;">Home</a></li>
                <li><a href="#services" style="color: #2563eb;">Services</a></li>
                <li><a href="#about" style="color: #2563eb;">About</a></li>
                <li><a href="#contact" style="color: #2563eb;">Contact</a></li>
                <li>
                    <div class="user-info">
                        <span id="userName">Welcome!</span>
                        <button class="btn-login" onclick="logout()">Logout</button>
                    </div>
                </li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Dashboard Header -->
    <section class="dashboard-header">
        <div class="container">
            <div class="header-content" data-aos="fade-up">
                <h1>Patient Portal</h1>
                <p>Manage your medical reports, appointments, and health information</p>
            </div>
        </div>
    </section>

    <!-- Introduction Section -->
    <section class="introduction">
        <div class="container">
            <div class="intro-content" data-aos="fade-up">
                <div class="intro-text">
                    <h2>Welcome to Our Advanced Maternity Care System</h2>
                    <p>Our cutting-edge application leverages artificial intelligence to analyze medical reports and scanning data from pregnant women, providing early detection and prediction of potential medical issues in fetal development.</p>
                    
                    <div class="features-grid">
                        <div class="feature-item" data-aos="fade-up" data-aos-delay="100">
                            <div class="feature-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <h3>AI-Powered Analysis</h3>
                            <p>Advanced machine learning algorithms analyze your medical data for accurate predictions</p>
                        </div>
                        
                        <div class="feature-item" data-aos="fade-up" data-aos-delay="200">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3>Early Detection</h3>
                            <p>Identify potential risks early in pregnancy for better outcomes</p>
                        </div>
                        
                        <div class="feature-item" data-aos="fade-up" data-aos-delay="300">
                            <div class="feature-icon">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <h3>Expert Guidance</h3>
                            <p>Receive recommendations from our medical experts based on analysis results</p>
                        </div>
                    </div>
                </div>
                
                <div class="intro-image" data-aos="fade-left">
                    <img src="{% static 'images/prenatal_ultrasound_images.jpg' %}"
                         alt="Doctor reviewing prenatal ultrasound images with expectant mother">
                </div>
            </div>
        </div>
    </section>

    <!-- Health Prediction Section -->
    <!-- <section class="health-prediction" style="background: #f8fafc; padding: 3rem 0;">
        <div class="container">
            <div class="section-header" data-aos="fade-up">
                <h2>AI Health Predictions</h2>
                <p>Get instant risk assessments using our advanced machine learning models</p>
            </div>
            
            <div class="prediction-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-top: 2rem;">
                Maternal Health Prediction -->
                <!-- <div class="prediction-card" style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);" data-aos="fade-up" data-aos-delay="100">
                    <h3 style="color: #2563eb; margin-bottom: 1rem;">
                        <i class="fas fa-heartbeat"></i> Maternal Health Assessment
                    </h3>
                    <form id="maternalHealthForm" onsubmit="predictMaternalHealth(event)">
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: #1e293b; font-weight: 500;">Age</label>
                                <input type="number" name="age" required min="15" max="50" style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: #1e293b; font-weight: 500;">Systolic BP (mmHg)</label>
                                <input type="number" name="systolic_bp" required min="80" max="200" style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: #1e293b; font-weight: 500;">Diastolic BP (mmHg)</label>
                                <input type="number" name="diastolic_bp" required min="50" max="150" style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: #1e293b; font-weight: 500;">Blood Sugar (mg/dL)</label>
                                <input type="number" name="bs" required min="0" max="300" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: #1e293b; font-weight: 500;">Heart Rate (bpm)</label>
                                <input type="number" name="heart_rate" required min="50" max="150" style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: #1e293b; font-weight: 500;">Body Temperature (°F) <small style="color: #64748b;">(Optional)</small></label>
                                <input type="number" name="body_temp" min="0" max="105" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <button type="submit" class="btn-primary" style="width: 100%; padding: 0.75rem; margin-top: 0.5rem;">
                                <i class="fas fa-brain"></i> Get Prediction
                            </button>
                        </div>
                    </form>
                    <div id="maternalHealthResult" style="margin-top: 1.5rem; display: none;"></div>
                </div>
                 -->
                <!-- Preterm Delivery Prediction -->
                <!-- <div class="prediction-card" style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);" data-aos="fade-up" data-aos-delay="200">
                    <h3 style="color: #2563eb; margin-bottom: 1rem;">
                        <i class="fas fa-baby"></i> Preterm Delivery Risk Assessment
                    </h3>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 1rem;">
                        Upload an ultrasound or medical image for analysis
                    </p>
                    <form id="pretermDeliveryForm" onsubmit="predictPretermDelivery(event)" enctype="multipart/form-data">
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: #1e293b; font-weight: 500;">Medical Image</label>
                                <input type="file" name="image" accept="image/*" required style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 6px;">
                                <small style="color: #64748b; display: block; margin-top: 0.25rem;">Supported formats: JPG, PNG, JPEG</small>
                            </div>
                            <button type="submit" class="btn-primary" style="width: 100%; padding: 0.75rem; margin-top: 0.5rem;">
                                <i class="fas fa-brain"></i> Analyze Image
                            </button>
                        </div>
                    </form>
                    <div id="pretermDeliveryResult" style="margin-top: 1.5rem; display: none;"></div>
                </div>
            </div>
        </div>
    </section> -->

    <!-- Upload Options Section -->
    <section class="upload-options">
        <div class="container">
            <div class="section-header" data-aos="fade-up">
                <h2>Get Your Analysis</h2>
                <p>Choose the type of analysis you need for comprehensive maternity care</p>
            </div>
            
            <div class="options-grid">
                <!-- Scanning Report Option -->
                <div class="option-card" data-aos="fade-up" data-aos-delay="100">
                    <div class="option-header">
                        <div class="option-icon scanning">
                            <i class="fas fa-x-ray"></i>
                        </div>
                        <h3>Scanning Report Analysis</h3>
                        <p>Upload ultrasound scans, MRI, or other imaging reports for AI-powered fetal development analysis</p>
                    </div>
                    
                    <div class="option-content">
                        <div class="upload-area" id="scanningUpload">
                            <div class="upload-placeholder">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drop your scanning reports here or <span class="upload-link">browse files</span></p>
                                <small>Supported formats: PDF, JPEG, PNG, DICOM (Max 10MB)</small>
                            </div>
                            <input type="file" id="scanningFiles" multiple accept=".pdf,.jpg,.jpeg,.png,.dcm" hidden>
                        </div>
                        
                        <div class="upload-info">
                            <h4>What we analyze:</h4>
                            <ul>
                                <li><i class="fas fa-check"></i> Fetal growth measurements</li>
                                <li><i class="fas fa-check"></i> Organ development assessment</li>
                                <li><i class="fas fa-check"></i> Placental position and health</li>
                                <li><i class="fas fa-check"></i> Amniotic fluid levels</li>
                            </ul>
                            <p class="upload-hint">Upload your scans here, then run a combined analysis below.</p>
                        </div>
                    </div>
                </div>

                <!-- Medical Reports Option -->
                <div class="option-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="option-header">
                        <div class="option-icon medical">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <h3>Medical Report Analysis</h3>
                        <p>Upload lab results, medical history, and clinical reports for comprehensive health assessment</p>
                    </div>
                    
                    <div class="option-content">
                        <div class="upload-area" id="medicalUpload">
                            <div class="upload-placeholder">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drop your medical reports here or <span class="upload-link">browse files</span></p>
                                <small>Supported formats: PDF, DOC, DOCX, TXT (Max 5MB each)</small>
                            </div>
                            <input type="file" id="medicalFiles" multiple accept=".pdf,.doc,.docx,.txt" hidden>
                        </div>
                        
                        <div class="upload-info">
                            <h4>What we analyze:</h4>
                            <ul>
                                <li><i class="fas fa-check"></i> Blood test results</li>
                                <li><i class="fas fa-check"></i> Genetic screening reports</li>
                                <li><i class="fas fa-check"></i> Medical history patterns</li>
                                <li><i class="fas fa-check"></i> Risk factor assessment</li>
                            </ul>
                            <p class="upload-hint">Upload your reports here, then run a combined analysis below.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Combined Analysis Option -->
            <div class="combined-analysis" data-aos="fade-up" data-aos-delay="300">
                <div class="combined-card">
                    <div class="combined-header">
                        <div class="combined-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <h3>Comprehensive Analysis</h3>
                        <p>Get the most accurate predictions by combining both scanning and medical reports</p>
                    </div>
                    <button class="btn-secondary" onclick="processCombinedAnalysis()" disabled id="combinedBtn">
                        <i class="fas fa-magic"></i>
                        Run Combined Analysis
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Recent Reports Section -->
    <section class="recent-reports">
        <div class="container">
            <div class="section-header" data-aos="fade-up">
                <h2>Recent Analysis History</h2>
                <p>View your previous reports and track your pregnancy journey</p>
            </div>
            
            <div class="reports-grid" id="reportsHistory">
                <!-- Reports will be populated by JavaScript -->
                <div class="no-reports" data-aos="fade-up">
                    <i class="fas fa-clipboard-list"></i>
                    <h3>No Reports Yet</h3>
                    <p>Upload your first medical or scanning report to get started with AI-powered analysis</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-baby"></i>
                        <span>FetoScope</span>
                    </div>
                    <p>Advanced maternity and fetal-care insights with AI-powered predictions for better outcomes.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="{% url 'feetal_app:index' %}">Home</a></li>
                        <li><a href="#services">Services</a></li>
                        <li><a href="#about">About</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#help">Help Center</a></li>
                        <li><a href="#privacy">Privacy Policy</a></li>
                        <li><a href="#terms">Terms of Service</a></li>
                        <li><a href="#contact">Contact Support</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <div class="contact-info">
                        <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                        <p><i class="fas fa-envelope"></i> support@fetoscope.com</p>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 FetoScope. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Loading Modal -->
    <div id="loadingModal" class="modal">
        <div class="modal-content loading-content">
            <div class="loading-animation">
                <div class="spinner"></div>
                <h3>Analyzing Your Reports</h3>
                <p id="loadingText">Processing your medical data with AI...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Result Modal (AI Analysis Output) -->
<div id="resultModal" class="modal" style="display:none;">
    <div class="modal-content" id="resultModalContent" style="max-width:650px; max-height:85vh; overflow-y:auto; border-radius:12px; padding:25px; position:relative;">
    </div>
</div>

    <!-- Appointment Booking Modal -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content appointment-modal">
            <div class="modal-header">
                <h2>Book Your Appointment</h2>
                <span class="close" onclick="closeModal('appointmentModal')">&times;</span>
            </div>
            <form class="appointment-form" onsubmit="handleAppointmentBooking(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="patientName">Full Name *</label>
                        <input type="text" id="patientName" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="patientPhone">Phone Number *</label>
                        <input type="tel" id="patientPhone" required placeholder="Enter your phone number">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="patientEmail">Email Address *</label>
                        <input type="email" id="patientEmail" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="patientAge">Age *</label>
                        <input type="number" id="patientAge" required min="1" max="120" placeholder="Enter your age">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="appointmentDepartment">Department *</label>
                        <select id="appointmentDepartment" required onchange="updateDoctorsList()">
                            <option value="">Select Department</option>
                            <option value="obgyn">Obstetrics & Gynecology</option>
                            <option value="mfm">Maternal-Fetal Medicine</option>
                            <option value="radiology">Fetal Radiology</option>
                            <option value="pediatrics">Neonatology / Pediatrics</option>
                            <option value="prenatal_counselling">Prenatal Counselling</option>
                            <option value="all">All Departments</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="appointmentDoctor">Preferred Doctor *</label>
                        <select id="appointmentDoctor" required disabled>
                            <option value="">Select a department first</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="appointmentDate">Preferred Date *</label>
                        <input type="date" id="appointmentDate" required min="">
                    </div>
                    <div class="form-group">
                        <label for="appointmentTime">Preferred Time *</label>
                        <select id="appointmentTime" required>
                            <option value="">Select Time</option>
                            <option value="09:00">09:00 AM</option>
                            <option value="09:30">09:30 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="10:30">10:30 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="11:30">11:30 AM</option>
                            <option value="14:00">02:00 PM</option>
                            <option value="14:30">02:30 PM</option>
                            <option value="15:00">03:00 PM</option>
                            <option value="15:30">03:30 PM</option>
                            <option value="16:00">04:00 PM</option>
                            <option value="16:30">04:30 PM</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="appointmentReason">Reason for Visit *</label>
                    <select id="appointmentReason" required>
                        <option value="">Select Reason</option>
                        <option value="routine-checkup">Routine Checkup</option>
                        <option value="prenatal-care">Prenatal Care</option>
                        <option value="ultrasound">Ultrasound Scan</option>
                        <option value="consultation">Medical Consultation</option>
                        <option value="follow-up">Follow-up Visit</option>
                        <option value="emergency">Emergency</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="appointmentNotes">Additional Notes (Optional)</label>
                    <textarea id="appointmentNotes" placeholder="Any specific concerns or information you'd like to share..." rows="3"></textarea>
                </div>

                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="appointmentTerms" required>
                        <span class="checkmark"></span>
                        I agree to the <a href="#" target="_blank">Terms and Conditions</a> and <a href="#" target="_blank">Privacy Policy</a>
                    </label>
                </div>

                <div class="appointment-summary" id="appointmentSummary" style="display: none;">
                    <h4>Appointment Summary</h4>
                    <div class="summary-content"></div>
                </div>

                <button type="submit" class="btn-primary full-width">Book Appointment</button>
                <p class="appointment-note">
                    <i class="fas fa-info-circle"></i>
                    You will receive a confirmation email and SMS with appointment details.
                </p>
            </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const currentUser = sessionStorage.getItem("currentUser");
    if (!currentUser) return;

    const user = JSON.parse(currentUser);

    // Automatically prefill when patient-portal page loads
    const fill = () => {
        const nameField = document.getElementById("patientName");
        const emailField = document.getElementById("patientEmail");
        const phoneField = document.getElementById("patientPhone");

        if (nameField) nameField.value = user.name || "";
        if (emailField) emailField.value = user.email || "";
        if (phoneField) phoneField.value = user.phone || "";   // <-- FIXES PHONE
    };

    // Run when modal opens
    document.addEventListener("click", (e) => {
        if (e.target.matches("#openAppointmentBtn")) {
            setTimeout(fill, 300);
        }
    });

    // Also run automatically when redirected to appointment modal
    setTimeout(fill, 500);
});


document.addEventListener("DOMContentLoaded", function () {
    const dateInput = document.getElementById("appointmentDate");
    const timeSelect = document.getElementById("appointmentTime");

    if (!dateInput || !timeSelect) return;

    dateInput.addEventListener("change", function () {
        const selected = new Date(this.value);
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        if (selected < today) {
            alert("⚠ You cannot book an appointment for a past date.");
            this.value = "";
            timeSelect.disabled = true;
            timeSelect.value = "";
            return;
        }

        // If valid date → enable time select
        timeSelect.disabled = false;

        // Handle time restriction when booking for TODAY
        const now = new Date();
        for (let opt of timeSelect.options) opt.style.display = "block"; // reset

        if (selected.toDateString() === today.toDateString()) {
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            for (let opt of timeSelect.options) {
                const val = opt.value;
                if (!val) continue;
                let [h, m] = val.split(":");
                let optionMinutes = parseInt(h) * 60 + parseInt(m);

                if (optionMinutes <= currentMinutes) {
                    opt.style.display = "none"; // hide past times
                }
            }
        }
    });

    // Set tomorrow as minimum date
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    dateInput.min = tomorrow.toISOString().split("T")[0];
    timeSelect.disabled = true; // initially disabled
});

</script>


    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="{% static 'js/patient-portal.js' %}"></script>
</body>
</html>
